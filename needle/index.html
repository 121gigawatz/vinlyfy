<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Transform your digital audio into warm, nostalgic vinyl records with authentic vinyl effects.">
  <meta name="theme-color" content="#d4a574">
  
  <!-- PWA Meta Tags -->
  <link rel="manifest" href="/manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Vinylfy">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
  <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="/api">
  
  <title>Vinylfy</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="/css/variables.css?v=beta2.3.1">
  <link rel="stylesheet" href="/css/base.css?v=beta2.3.1">
  <link rel="stylesheet" href="/css/components.css?v=beta2.3.1">
  <link rel="stylesheet" href="/css/responsive.css?v=beta2.3.1">
</head>
<body>
  <!-- Header -->
  <header class="app-header container" style="padding-top: var(--space-xs); padding-bottom: var(--space-lg);">
    <div class="flex-between mobile-flex-col gap-md">
      <div>
        <h1 style="margin-bottom: var(--space-xs); display: flex; align-items: center; gap: var(--space-sm);">
          <img src="assets/icons/favicon-96x96.png" alt="Vinylfy icon" style="width: 48px; height: 48px;">
          <span style="color: var(--color-primary);">Vinylfy</span>
        </h1>
      </div>
      <div class="flex gap-sm" style="align-items: center;">
        <!-- GitHub Link -->
        <a id="githubLink" href="https://github.com/121gigawatz/vinylfy" target="_blank" rel="noopener noreferrer" class="github-link" title="View on GitHub">
          <svg class="github-icon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true">
            <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
          </svg>
          <span id="starCount" class="star-count">
            <span class="star-icon">‚≠ê</span>
            <span id="starNumber">‚Äî</span>
          </span>
        </a>

        <div class="theme-toggle-group" style="display: flex; gap: 4px; background: var(--color-bg-secondary); border-radius: var(--radius-md); padding: 2px;">
          <button id="themeLight" class="theme-toggle-btn" data-theme="light" aria-label="Light mode" title="Light mode">‚òÄÔ∏è</button>
          <button id="themeDark" class="theme-toggle-btn" data-theme="dark" aria-label="Dark mode" title="Dark mode">üåô</button>
          <button id="themeAuto" class="theme-toggle-btn active" data-theme="auto" aria-label="Auto mode" title="Auto mode">Auto</button>
        </div>
        <span id="healthStatus" class="badge badge-secondary">Checking...</span>
        <button id="installBtn" class="btn btn-ghost btn-sm hidden" aria-label="Install app">
          üì≤ Install
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container" style="padding-bottom: var(--space-xs);">
    
    <!-- Hero Section -->
    <section class="hero animate-fadeIn">
      <div class="hero-content">
        <div class="vinyl-record spinning" style="margin: 0 auto var(--space-xs); width: 80px; height: 80px;"></div>
        <h1 class="hero-title">Give Your Digital Music That Vinyl Sound</h1>
        <p class="hero-subtitle">Transform digital audio into warm, nostalgic vinyl records</p>
        <div class="hero-features">
          <span class="hero-feature">üéß Authentic Sound</span>
          <span class="hero-feature">‚ö° Fast Processing</span>
          <span class="hero-feature">üì± Any Device</span>
          <span class="hero-feature">üéµ Multiple Formats</span>
        </div>
      </div>
    </section>

    <!-- Step 1: Upload Your Audio -->
    <section class="section animate-slideUp" style="margin-top: var(--space-xs); margin-bottom: var(--space-xs);">
      <div class="card card-glow gradient-border">
        <div class="card-header">
          <div style="display: flex; align-items: center; gap: var(--space-xs);">
            <span class="step-indicator">1</span>
            <div>
              <h2 class="card-title" style="margin-bottom: var(--space-xs);">Upload Your Audio</h2>
              <p class="card-subtitle">Select an audio file to vinylfy</p>
            </div>
          </div>
        </div>

          <div class="card-body">
            <div class="file-upload">
              <input
                type="file"
                id="audioFile"
                accept="audio/*,.wav,.mp3,.flac,.ogg,.m4a,.aac"
                aria-label="Upload audio file"
              >
              <label for="audioFile" class="file-upload-label" id="fileUploadLabel">
                <div class="file-upload-icon">üéß</div>
                <div class="file-upload-text">Click or drag audio file here</div>
                <div class="file-upload-hint" id="fileUploadHint">Supports: WAV, MP3, FLAC, OGG, M4A, AAC (Max 25MB)</div>
              </label>
            </div>

            <!-- File Info -->
            <div id="fileInfo" class="hidden" style="margin-top: var(--space-xs);">
              <div class="alert alert-success">
                <strong>File loaded:</strong> <span id="fileName"></span>
                <br>
                <strong>Size:</strong> <span id="fileSize"></span>
              </div>
            </div>
          </div>
        </div>
    </section>

    <!-- Step 2: Configure Settings -->
    <section class="section animate-slideUp" style="animation-delay: 0.1s; margin-top: var(--space-xs); margin-bottom: var(--space-xs);">
      <div class="card card-glow gradient-border">
        <div class="card-header">
          <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
            <div style="display: flex; align-items: center; gap: var(--space-xs);">
              <span class="step-indicator">2</span>
              <div>
                <h2 class="card-title" style="margin-bottom: var(--space-sm);">Choose Your Vinyl Effect</h2>
                <p class="card-subtitle">Select a preset or customize your own</p>
              </div>
            </div>
            <button id="howItWorksBtn" class="btn btn-ghost btn-sm" style="width: 32px; height: 32px; min-width: 32px; min-height: 32px; flex-shrink: 0; padding: 0; border-radius: 50%; border: 2px solid var(--color-primary); color: var(--color-primary); font-size: var(--font-size-md); display: flex; align-items: center; justify-content: center;" title="How does Vinylfy work?" aria-label="How it works">
              ?
            </button>
          </div>
        </div>

        <div class="card-body">
          <!-- Preset and Format Selectors -->
          <div class="form-row" style="margin-bottom: var(--space-xs);">
            <div class="form-group">
              <label for="presetSelector" class="form-label">Vinyl Preset</label>
              <select id="presetSelector" class="form-select">
                <option value="light">Light - Subtle vinyl character</option>
                <option value="medium" selected>Medium - Classic vinyl sound</option>
                <option value="heavy">Heavy - Well-worn record</option>
                <option value="vintage">Vintage - Old, heavily-played</option>
                <option value="custom">Custom - Full control</option>
              </select>
            </div>

            <div class="form-group">
              <label for="formatSelector" class="form-label">Output Format</label>
              <select id="formatSelector" class="form-select">
                <option value="aac">AAC (High Quality, Smaller)</option>
                <option value="mp3" selected>MP3 (Most Compatible)</option>
                <option value="flac">FLAC (Lossless)</option>
                <option value="ogg">OGG (Compressed)</option>
                <option value="wav">WAV (Highest Quality)</option>
              </select>
            </div>
          </div>

          <!-- Custom Controls in Two Columns -->
          <div id="customControls" style="padding-top: var(--space-xs); border-top: 1px solid var(--color-border);">
            <h3 style="margin-bottom: var(--space-xs); color: var(--color-primary); font-size: var(--font-size-lg);">Custom Settings</h3>

            <div class="two-column-layout">
              <!-- Left Column Controls -->
              <div>
                <!-- Frequency Response -->
                <div class="form-group">
                  <label class="toggle">
                    <input type="checkbox" id="frequencyResponse" class="toggle-input" checked>
                    <span class="toggle-switch"></span>
                    <span>Frequency Response (RIAA curve)</span>
                  </label>
                </div>

                <!-- Surface Noise -->
                <div class="form-group">
                  <label class="toggle">
                    <input type="checkbox" id="surfaceNoise" class="toggle-input" checked>
                    <span class="toggle-switch"></span>
                    <span>Surface Noise (crackles & pops)</span>
                  </label>
                </div>

                <div class="range-group" id="noiseIntensityGroup">
                  <div class="range-label">
                    <span>Noise Intensity</span>
                    <span class="range-value" id="noiseIntensityValue">0.020</span>
                  </div>
                  <input
                    type="range"
                    id="noiseIntensity"
                    class="range-input"
                    min="0"
                    max="0.1"
                    step="0.001"
                    value="0.02"
                  >
                </div>

                <div class="range-group" id="popIntensityGroup">
                  <div class="range-label">
                    <span>Pop Intensity</span>
                    <span class="range-value" id="popIntensityValue">0.60</span>
                  </div>
                  <input
                    type="range"
                    id="popIntensity"
                    class="range-input"
                    min="0"
                    max="1.0"
                    step="0.05"
                    value="0.6"
                  >
                </div>

                <!-- Wow & Flutter -->
                <div class="form-group">
                  <label class="toggle">
                    <input type="checkbox" id="wowFlutter" class="toggle-input" checked>
                    <span class="toggle-switch"></span>
                    <span>Wow & Flutter (pitch variations)</span>
                  </label>
                </div>

                <div class="range-group" id="wowFlutterIntensityGroup">
                  <div class="range-label">
                    <span>Wow/Flutter Intensity</span>
                    <span class="range-value" id="wowFlutterValue">0.0010</span>
                  </div>
                  <input
                    type="range"
                    id="wowFlutterIntensity"
                    class="range-input"
                    min="0"
                    max="0.01"
                    step="0.0001"
                    value="0.001"
                  >
                </div>
              </div>

              <!-- Right Column Controls -->
              <div>
                <!-- Harmonic Distortion -->
                <div class="form-group">
                  <label class="toggle">
                    <input type="checkbox" id="harmonicDistortion" class="toggle-input" checked>
                    <span class="toggle-switch"></span>
                    <span>Harmonic Distortion (analog warmth)</span>
                  </label>
                </div>

                <div class="range-group" id="distortionAmountGroup">
                  <div class="range-label">
                    <span>Distortion Amount</span>
                    <span class="range-value" id="distortionValue">0.15</span>
                  </div>
                  <input
                    type="range"
                    id="distortionAmount"
                    class="range-input"
                    min="0"
                    max="1"
                    step="0.01"
                    value="0.15"
                  >
                </div>

                <!-- Stereo Reduction -->
                <div class="form-group">
                  <label class="toggle">
                    <input type="checkbox" id="stereoReduction" class="toggle-input" checked>
                    <span class="toggle-switch"></span>
                    <span>Stereo Reduction (limited separation)</span>
                  </label>
                </div>

                <div class="range-group" id="stereoWidthGroup">
                  <div class="range-label">
                    <span>Stereo Width</span>
                    <span class="range-value" id="stereoWidthValue">0.70</span>
                  </div>
                  <input
                    type="range"
                    id="stereoWidth"
                    class="range-input"
                    min="0"
                    max="1"
                    step="0.01"
                    value="0.7"
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Process Button -->
        <div class="card-footer">
          <button id="processBtn" class="btn btn-primary btn-lg btn-full" disabled>
            Process Audio
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: 8px; vertical-align: middle;">
              <line x1="5" y1="12" x2="19" y2="12"/>
              <polyline points="12 5 19 12 12 19"/>
            </svg>
          </button>
        </div>
      </div>
    </section>

    <!-- Processing Indicator -->
    <section id="processingIndicator" class="section hidden animate-fadeIn">
      <div class="card card-elevated text-center">
        <div class="vinyl-record spinning" style="margin: 0 auto var(--space-sm);"></div>
        <h3 style="color: var(--color-primary);">Processing Your Audio...</h3>
        <p class="text-secondary">Adding that warm vinyl character üé∂</p>
      </div>
    </section>

    <!-- Results Section -->
    <section id="resultsSection" class="section hidden animate-slideUp">
      <div class="card card-elevated card-glow gradient-border">
        <div class="card-header">
          <div style="display: flex; align-items: center; gap: var(--space-xs);">
            <span class="step-indicator">3</span>
            <div>
              <h2 class="card-title" style="margin-bottom: var(--space-xs);">Preview & Download</h2>
              <p class="card-subtitle">Your vinylified audio is ready! üéâ</p>
            </div>
          </div>
        </div>
        
        <div class="card-body">
          <!-- File Details -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md); margin-bottom: var(--space-lg);">
            <div>
              <div class="text-muted" style="font-size: var(--font-size-sm);">Filename</div>
              <div id="resultFileName" style="font-weight: var(--font-weight-medium); word-break: break-all;">-</div>
            </div>
            <div>
              <div class="text-muted" style="font-size: var(--font-size-sm);">Size</div>
              <div id="resultFileSize" style="font-weight: var(--font-weight-medium);">-</div>
            </div>
            <div>
              <div class="text-muted" style="font-size: var(--font-size-sm);">Preset</div>
              <div id="resultPreset" style="font-weight: var(--font-weight-medium);">-</div>
            </div>
            <div>
              <div class="text-muted" style="font-size: var(--font-size-sm);">Format</div>
              <div id="resultFormat" style="font-weight: var(--font-weight-medium);">-</div>
            </div>
          </div>

          <div class="alert alert-info">
            ‚è±Ô∏è This file will expire in <strong id="expiresIn">-</strong>
          </div>

          <!-- Audio Player -->
          <div id="audioPlayerContainer" class="hidden"></div>

          <!-- Action Buttons -->
          <div class="btn-group" style="margin-top: var(--space-xs);">
            <button id="previewBtn" class="btn btn-secondary btn-lg">
              üéß Preview
            </button>
            <button id="downloadBtn" class="btn btn-primary btn-lg">
              ‚¨á Download
            </button>
            <button id="discardBtn" class="btn btn-ghost btn-lg" style="border: 1px solid var(--color-error);">
              üóëÔ∏è Discard
            </button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="app-footer text-center" style="padding: var(--space-xs) 0; border-top: 1px solid var(--color-border); background: linear-gradient(180deg, transparent 0%, rgba(212, 165, 116, 0.05) 100%);">
    <div class="container">
      <img src="assets/icons/favicon-96x96.png" alt="Vinylfy icon" style="width: 60px; height: 60px; margin: 0 auto var(--space-md); display: block;">
      <p style="font-size: var(--font-size-lg); color: var(--color-primary); font-weight: var(--font-weight-medium); margin-bottom: var(--space-sm);">
        Vinylfy
      </p> 
      <p id="appVersion" style="font-size: var(--font-size-sm); color: var(--color-primary); font-weight: var(--font-weight-light); margin-bottom: var(--space-sm);">
        Version: BETA 2
      </p>
      <p class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">
        Transform digital audio into warm vinyl records
      </p>
      <div style="display: flex; gap: var(--space-xs); justify-content: center; flex-wrap: wrap; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
        <span>üéµ Authentic Sound</span>
        <span>‚ö° Fast Processing</span>
        <span>üîí Privacy First</span>
        <span>üì± PWA Ready</span>
      </div>
      <p class="text-muted" style="font-size: var(--font-size-xs); margin-top: var(--space-xs);">
        Made with ‚ù§Ô∏è for AJW and vinyl enthusiasts ‚Ä¢ <span id="fileTTL">Files auto-delete after 1 hour</span>
      </p>
    </div>
  </footer>

  <!-- Cache Update Modal -->
  <div id="cacheUpdateModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 style="color: var(--color-primary); margin: 0;">üîÑ Update Available</h3>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: var(--space-md); color: var(--color-text-primary);">
          A new version of Vinylfy is available! Your browser is showing an older cached version.
        </p>
        <div style="background: var(--color-bg-secondary); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
          <p style="margin: 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
            <strong>Current cached:</strong> <span id="cachedVersion">‚Äî</span><br>
            <strong>Latest version:</strong> <span id="latestVersion">‚Äî</span>
          </p>
        </div>

        <!-- Release Notes Section -->
        <div id="releaseNotesSection" style="margin-bottom: var(--space-md); display: none;">
          <h4 style="font-size: var(--font-size-md); color: var(--color-primary); margin-bottom: var(--space-sm); display: flex; align-items: center; gap: var(--space-xs);">
            ‚ú® What's New In This Release
          </h4>
          <div id="releaseNotesContent" style="background: var(--color-bg-tertiary); padding: var(--space-md); border-radius: var(--radius-md); border-left: 3px solid var(--color-primary); max-height: 250px; overflow-y: auto;">
            <!-- Release notes will be inserted here -->
          </div>
        </div>

        <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--space-md);">
          Click the button below to clear your cache and reload the latest version.
        </p>
      </div>
      <div class="modal-footer" style="display: flex; gap: var(--space-sm); justify-content: flex-end;">
        <button id="dismissCacheModal" class="btn btn-ghost">Later</button>
        <button id="clearCacheBtn" class="btn btn-primary">
          üßπ Clear Cache & Reload
        </button>
      </div>
    </div>
  </div>

  <!-- How It Works Modal -->
  <div id="howItWorksModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 style="color: var(--color-primary); margin: 0; display: flex; align-items: center; gap: var(--space-xs);">
          <span>‚ÑπÔ∏è</span>
          <span>How It Works</span>
        </h3>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: var(--space-md); color: var(--color-text-primary);">
          Vinylfy simulates the authentic sound of vinyl records by applying the following audio effects:
        </p>

        <div style="display: grid; gap: var(--space-md);">
          <!-- Surface Noise -->
          <div style="display: flex; gap: var(--space-sm); align-items: start;">
            <span style="font-size: var(--font-size-xl);"></span>
            <div>
              <strong style="color: var(--color-text-primary); font-size: var(--font-size-sm);">Surface Noise</strong>
              <p style="margin: var(--space-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                Adds the characteristic crackle and pops found on vinyl records. The higher the intensity setting, the more pronounced the noise.
              </p>
            </div>
          </div>

          <!-- Frequency Response -->
          <div style="display: flex; gap: var(--space-sm); align-items: start;">
            <span style="font-size: var(--font-size-xl);"></span>
            <div>
              <strong style="color: var(--color-text-primary); font-size: var(--font-size-sm);">Frequency Response</strong>
              <p style="margin: var(--space-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                Applies the RIAA equalization curve that shapes vinyl's unique tonal character.
              </p>
            </div>
          </div>

          <!-- Wow & Flutter -->
          <div style="display: flex; gap: var(--space-sm); align-items: start;">
            <span style="font-size: var(--font-size-xl);"></span>
            <div>
              <strong style="color: var(--color-text-primary); font-size: var(--font-size-sm);">Wow & Flutter</strong>
              <p style="margin: var(--space-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                Subtle pitch variations caused by turntable motor speed inconsistencies.
              </p>
            </div>
          </div>

          <!-- Harmonic Distortion -->
          <div style="display: flex; gap: var(--space-sm); align-items: start;">
            <span style="font-size: var(--font-size-xl);"></span>
            <div>
              <strong style="color: var(--color-text-primary); font-size: var(--font-size-sm);">Harmonic Distortion</strong>
              <p style="margin: var(--space-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                Warmth and richness from analog playback imperfections not found in digital audio.
              </p>
            </div>
          </div>

          <!-- Stereo Reduction -->
          <div style="display: flex; gap: var(--space-sm); align-items: start;">
            <span style="font-size: var(--font-size-xl);"></span>
            <div>
              <strong style="color: var(--color-text-primary); font-size: var(--font-size-sm);">Stereo Reduction</strong>
              <p style="margin: var(--space-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                Narrows the stereo field to match vinyl's physical limitations of stereo separation.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; justify-content: flex-end;">
        <button id="closeHowItWorksModal" class="btn btn-primary">
          I'm Ready to Vinylfy my Music
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module" src="/js/app.js?v=beta2.3.1"></script>
</body>
</html>